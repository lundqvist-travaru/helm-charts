
{{- define "lugo.postgres-secrets" }}
{{- required "A valid .Values.global.database entry required" .Values.global.database -}}
{{- $username := .Values.global.database.username -}}
{{- $password := .Values.global.database.password -}}
{{- $port := (( .Values.global.database.port | toString )) -}}
{{- $host := .Values.global.database.host }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-postgres-secrets
type: Opaque
data:
  username: {{ $username | b64enc }} 
  password: {{ $password | b64enc }} 
  connectionString: {{ printf "User ID=%s;Password=%s;Host=%s;Port=%s;Database=%s;" $username $password $port .Values.service.name | b64enc | quote }} 
{{- end }}


{{- define "lugo.tls-secrets" }}
{{- $cert := required "A valid .Values.global.tls.cert entry required" .Values.global.tls.cert -}}
{{- $key := required "A valid .Values.global.tls.key entry required" .Values.global.tls.key }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-tls-secrets
  namespace: default
data:
  tls.crt: {{ $cert | b64enc }}
  tls.key: {{ $key | b64enc }}
type: kubernetes.io/tls
{{- end }}